# Phase 7 Audit Summary

## Findings

**2 CRITICAL issues found:**

1. **DirtyOperation missing from menuGenerators** (menu.go:30-37)
   - SPEC requires ALL Operation types to have menu handlers
   - Currently only 6 of 7 operations handled
   - `git.DirtyOperation` will cause panic if detected
   - git/state.go works around this by returning Conflicted instead (WRONG)

2. **Time travel menu items NOT in SSOT** (menu.go:239-250)
   - Using `Item()` builder instead of `GetMenuItem()`
   - Items should be in menuitems.go with global validation
   - Violates ARCHITECTURE.md MenuItem SSOT pattern

**3 MEDIUM issues found:**

3. Missing "View diff" option from time travel menu (vs SPEC.md:136-139)
4. Using old Item() builder pattern instead of GetMenuItem()
5. Using CurrentBranch for original branch label (should read from .git/TIT_TIME_TRAVEL file)

---

## Impact Assessment

✅ **What Works Correctly:**
- State detection priority (conflicts → time travel → merge/rebase → normal)
- Time travel file I/O (.git/TIT_TIME_TRAVEL handling)
- Async operation pattern (workers, messages, handlers)
- Dirty tree stash/restore logic
- Message dispatch chain in app.go

❌ **What's Broken:**
- DirtyOperation state will crash the menu generator
- Time travel menu violates SSOT architecture rule
- Menu labels may show wrong branch name
- Missing menu option for viewing diffs

---

## Fix Priority

**Must fix before testing:**
1. Add DirtyOperation to menuGenerators (~3 lines)
2. Move time travel items to SSOT (~15 lines)
3. Fix originalBranch lookup (~3 lines)

**Should fix:**
4. Add "View diff" option to time travel menu (~5 lines)

---

See PHASE-7-AUDIT.md for detailed analysis and code examples.
